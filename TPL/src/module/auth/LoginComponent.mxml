<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" layout="vertical" width="400" height="260" title="登录" horizontalAlign="center" verticalAlign="middle" creationComplete="init()">
	<mx:Form>
		<mx:FormItem label="帐号">
			<mx:TextInput id="loginname" maxChars="20" text="UtmostAdmin"/>
		</mx:FormItem>
		<mx:FormItem label="密码">
			<mx:TextInput id="password" displayAsPassword="true" maxChars="20" text="UtmostAdmin"/>
		</mx:FormItem>
	</mx:Form>
	<mx:HBox width="70%" horizontalAlign="center" verticalAlign="middle">
		<mx:CheckBox id="cbName" label="记住帐号"/>
		<mx:Spacer width="30" height="45"/>
		<mx:CheckBox id="cbPwd" label="记住密码"/>
	</mx:HBox>
	<!--mx:Button label="权限测试" click="LoginService.findPurview('wlm')"/-->
	<mx:ControlBar horizontalAlign="center" verticalAlign="middle">
		<mx:HBox width="100%" height="30" verticalAlign="middle" horizontalAlign="center" horizontalGap="20">
			<mx:Button label="登录系统" click="loginPortal()"/>
			<mx:Button label="登录开发" click="loginProgramme()"/>
		</mx:HBox>
	</mx:ControlBar>
	<mx:Script>
		<![CDATA[
			import org.utmost.util.UtmostLSOBean;
			import org.utmost.util.UtmostLSO;
			import mx.managers.PopUpManager;

			private function init():void
			{
				initLSO();
			}

			private function initLSO():void
			{
				var ul:UtmostLSO=new UtmostLSO();
				var bean:Object=ul.defaultObj();
				if (bean != null)
				{
					loginname.text=bean.username;
					password.text=bean.password;
					cbName.selected=bean.saveName;
					cbPwd.selected=bean.savePwd;
				}
			}

			private function saveLSO():void
			{
				var ulb:UtmostLSOBean=new UtmostLSOBean();
				var ul:UtmostLSO=new UtmostLSO();
				if (cbName.selected)
				{
					ulb.saveName=true;
					ulb.username=loginname.text;
				}
				if (cbPwd.selected)
				{
					ulb.savePwd=true;
					ulb.password=password.text;
				}
				ul.saveLSO(ulb)
			}

			private function loginPortal():void
			{
				if (loginname.text == "UtmostAdmin" && password.text == "UtmostAdmin")
				{
					trace("UtmostAdmin 登陆!");
					saveLSO();
					AuthUserBean.loginname=loginname.text;
					AuthUserBean.password=password.text;
				}
				this.dispatchEvent(new Event("LoginComponent_portal"));
				PopUpManager.removePopUp(this);
			}

			private function loginProgramme():void
			{
				this.dispatchEvent(new Event("LoginComponent_programme"));
				PopUpManager.removePopUp(this);
			}
		]]>
	</mx:Script>
</mx:TitleWindow>
